#!/usr/bin/env ruby

require 'pty'
require 'expect'

command="<%= scope.lookupvar('android::paths::sdk_home') %>/tools/bin/sdkmanager --update -u --include_obsolete -t <%= @package_name %> <%= @proxy_host %> <%= @proxy_port %>"
match=%r/^\s*Accept? .* \(y\/N\):\s*/
response="y"

puts command

PTY.spawn(command) do |r,w,p|

  w.sync = true

  begin
    while true do
      r.expect(match)
      sleep(0.1)
      w.puts(response)
    end
  rescue Errno::EIO, PTY::ChildExited
  end
end

exit
#  vim: set ts=2 sw=2 tw=0 et:
